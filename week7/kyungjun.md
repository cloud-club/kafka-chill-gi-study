

- https://www.confluent.io/blog/kafka-fastest-messaging-system/#fsync
- https://docs.tosspayments.com/blog/what-is-idempotency

```markdown
8.1.2 멱등적 프로듀서의 한계
카프카의 멱등적 프로듀서는 프로듀서의 내부 로직으로 인한 재시도로 발생할 경우 생기는 중복만을 방지한다.
동일한 메시지를 가지고 producer.send()를 두 번 호출하면 멱등적 프로듀서가 개입하지 않는 만큼 중복된 메시지가 생기게 된다. 프로듀서 입장에서는 전송된 레코드 두 개가 실제로는 동일한 레코드인지 확인할 방법이 없기 때문이다. 프로듀서 예외를 잡아서 애플리케이션이 직접 재시도하는 것보다는 프로듀서에 탑재된 재시도 메커니즘을 사용하는 것이 언제나 더 낫다. 멱등적 프로듀서는 이 패턴을 더 편리하게 만들어준다. (재시도를 할 때 중복을 피할 수 있는 가장 쉬운 방법이기 때문이다.)

여러 개의 인스턴스를 띄우거나 하나의 인스턴스에서 여러 개의 프로듀서를 띄우는 애플리케이션들 역시 흔하다. 만약 이러한 프로듀서들 중 두 개가 동일한 메시지를 전송하려 시도할 경우, 멱등적 프로듀서는 중복을 잡아내지 못한다. 이러한 사례는 파일 디렉토리와 같은 원본에서 데이터를 읽어서 카프카로 쓰는 애플리케이션에서 꽤 흔하다. 만약 동일한 파일을 읽어서 카프카에 레코드를 쓰는 두 개의 애플리케이션 인스턴스가 뜨게 되면 해당 파일의 레코드들은 2번 이상 쓰여지게 될 것이다.

멱등적 프로듀서는 프로듀서 자체의 재시도 메커니즘(프로듀서, 네트워크, 브로커 에러로 인해 발생하는)에 의한 중복만을 방지할 뿐, 그 이상은 하지 않는다.
```